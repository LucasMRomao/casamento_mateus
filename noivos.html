<!--Modal alterar senha noivos-->
<div class="modal fade" id="modalAlterarNoivo" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Alterar senha dos noivos</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
            <div class="input-group mb-3">
                <div class="input-group-prepend">
                  <span class="input-group-text" id="basic-addon1">Nova senha:</span>
                </div>
                <input type="password" id="iNovaSenhaNoivos" class="form-control" placeholder="Senha" aria-label="Username" aria-describedby="basic-addon1">
            </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal" id="bCancelarNoivos">Cancelar</button>
          <button type="button" class="btn btn-primary" data-dismiss="modal" id="bSalvarNoivos">Salvar</button>
        </div>
      </div>
    </div>
</div>

<!--Modal alterar senha padrinhos-->
<div class="modal fade" id="modalAlterarPadrinho" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Alterar senha dos padrinhos</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
            <div class="input-group mb-3">
                <div class="input-group-prepend">
                  <span class="input-group-text" id="basic-addon1">Nova senha:</span>
                </div>
                <input type="password" id="iNovaSenhaPadrinhos" class="form-control" placeholder="Senha" aria-label="Username" aria-describedby="basic-addon1">
            </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal" id="bCancelarPadrinhos">Cancelar</button>
          <button type="button" class="btn btn-primary" data-dismiss="modal" id="bSalvarPadrinhos">Salvar</button>
        </div>
      </div>
    </div>
</div>

<!--Modal confirmar exclusão presente-->
<div class="modal fade" id="modalConfirmarExclusao" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Confirmar exclusão</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
            <h2>Deseja realmente excluir o presente selecionado?</h2>
            <input type="text" style="display:none;" id="sTipoUsuario" />
            <input type="text" style="display:none;" id="sIdPresente" />
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Não</button>
          <button type="button" class="btn btn-primary" data-dismiss="modal" id="bExcluirPresente">Sim</button>
        </div>
      </div>
    </div>
</div>

<div class="container-fluid" id="dMain">
    <div class="alert alert-primary" role="alert" style="margin-top: 10px;">
        <div class="row">
            <div class="col-12">
                <h2>Alterar senha</h2>
            </div>
        </div>
        <div class="btn-group" role="group" aria-label="...">
            <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#modalAlterarNoivo">Noivos</button>&nbsp;
            <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#modalAlterarPadrinho">Padrinhos</button>
        </div>
        <div class="row" style="margin-top: 20px;">
            <div class="col-12">
                <h2>Presentes selecionados</h2>
            </div>
        </div>
        <div id="dListaPresentes">

        </div>
    </div>
</div>

<script type="text/javascript">
    $(function(){
        const firebaseConfig = {
            apiKey: "AIzaSyCfEVMcjvEc5aP48EGZKNGvApYBmpPxluw",
            authDomain: "casamento-mateus.firebaseapp.com",
            projectId: "casamento-mateus",
            storageBucket: "casamento-mateus.appspot.com",
            messagingSenderId: "514547738129",
            appId: "1:514547738129:web:fc9ac8cfe7a68ad21433b0",
            measurementId: "G-35M59W0GLJ"
        };

        if(!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }

        const auth = firebase.auth();
        const provider = new firebase.auth.GoogleAuthProvider();
        const db = firebase.firestore();

        db.collection("presentes_selecionados").onSnapshot((data) => {
            $("#dListaPresentes").html("");
            data.docs.map((val) => {
                let nome = val.data().nome;
                let presente = val.data().presente;
                let tipo_pessoa = val.data().tipo_pessoa;
                let id_presente = val.data().presente_id;
                console.log(nome);
                console.log(presente);

                $presente = "<div class='alert alert-success' style='margin-top: 10px;'>";
                $presente += "<div class='row'>"
                $presente += "<div class='col-1'>";
                $presente += "<button class='deletePresente' data-toggle='modal' data-target='#modalConfirmarExclusao' presente-id='";
                $presente += id_presente + "' tipo-pessoa='" + tipo_pessoa + "'>";
                $presente += "<img class='img-fluid' src='remove.png' /></button>"
                $presente += "</div>"; //Close div col-1
                $presente += "<div class='col-11'>";
                $presente += "<span><b>" + nome + "</b></span><br/>";
                $presente += "<span>" + presente + "</span>";
                $presente += "</div>"; //Close div col-11
                $presente += "</div>"; //Close div row
                $presente += "</div>"; //Close div alert
                $("#dListaPresentes").append($presente);
            });

            $(".deletePresente").click(function(){
                let idPresente = $(this).attr("presente-id");
                let tipo_pessoa = $(this).attr("tipo-pessoa");
                $("#sTipoUsuario").val(tipo_pessoa);
                $("#sIdPresente").val(idPresente);
            });
        });

        $("#bCancelarNoivos").click(function(){
            $("#iNovaSenhaNoivos").val('');
        });

        $("#bSalvarNoivos").click(function(){
            let newPass = $("#iNovaSenhaNoivos").val();

            if(newPass == ''){
                alert("Por favor, insira a nova senha!");
                return false;
            }else{
                db.collection("credenciais_noivos").doc("mqopqcTwcfQpXUYrCby7").update({senha: newPass});
                alert("Senha alterada com sucesso!");
                $("#iNovaSenhaNoivos").val('');
            }
        });

        $("#bCancelarPadrinhos").click(() => {
            $("#iNovaSenhaPadrinhos").val('');
        });

        $("#bSalvarPadrinhos").click(() => {
            let newPass = $("#iNovaSenhaPadrinhos").val();

            if(newPass == ''){
                alert("Por favor, insira a nova senha!");
                return false;
            }else{
                db.collection("credenciais_padrinhos").doc("T0gi5vNZw0ZG6t9EXClr").update({senha: newPass});
                alert("Senha alterada com sucesso!");
                $("#iNovaSenhaPadrinhos").val('');
            }
        });

        $("#bExcluirPresente").click(function(){
            let tipo_pessoa = $("#sTipoUsuario").val();
            let id_presente = $("#sIdPresente").val();
            let contPresente = 0;

            if(tipo_pessoa == 'padrinho'){
                db.collection("presentes_padrinhos").onSnapshot((data) => {
                    data.docs.map((val) => {
                        if(val.id == id_presente){
                            contPresente = val.data().quantidade;
                        }
                    });
                });

                console.log(id_presente + ": " + contPresente);
                contPresente++;

                db.collection("presentes_padrinhos").doc(id_presente).update({quantidade: contPresente});
            }else if(tipo_pessoa == 'convidado'){
                db.collection("presentes").onSnapshot((data) => {
                    data.docs.map((val) => {
                        if(val.id == id_presente){
                            contPresente = val.data().quantidade;
                        }
                    });
                });

                console.log(id_presente + ": " + contPresente);
                contPresente++;

                db.collection("presentes").doc(id_presente).update({quantidade: contPresente});
            }
        });
    });
</script>